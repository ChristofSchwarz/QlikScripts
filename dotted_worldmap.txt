// download app from https://github.com/ChristofSchwarz/QlikScripts/raw/master/Worldmap%20dotted.qvf

TextMap: 
LOAD Mid(@1,2) AS @1 
INLINE [                      
^            #### ##### ############       ####               ####     
^            ####### ###   #########                  ##     ########    ##       
^ ##       ######### ###    #######          ####    ##  #######################
^####################  ###  #####          #########################################
^###################  ####  ###    ##     #########################################
^#### ############    ###    ##        #  ### ###################################
^ #      ###########  #####           ### ## #############################    #
^         ##################          ### ################################  
^          ############### #            ##################################
^          ###############              #######   ## ####################  #
^          #############              ###  ######### ###################  #
^          ############               ## ### ########################  # #
^           ##########                ######     #####################  #
^            #########                ################################
^             ####   #               ############ ### ###############
^              ### # ##             ############# #####  ###########
^               ####   ##           ############## ###    ###  ###   #
^                  ##               ################      ##    ###  #
^                   ######           ################     ##     #    #
^                     ######          ##############           ##   #
^                    ########              ########            ## #####
^                    ##########            #######              ## ## ##### 
^                    ###########           #######               ##  #   ###
^                     ##########           #######                 ##      # #
^                     #########            #######  #                  ## #       
^                      ########            ####### ##                 ######   #
^                       #######             #####  #                #########   #
^                       #####               #####                   ##########
^                       #####               ####                    ##########
^                      #####                 ##                     ###  ####     #
^                      ####                                               ###     ##
^                      ###                                                 #     ##
^                      ##                                                        #
^                     ##
^                     ##
^                      #
] (no labels);

ContinentForPoint:
MAPPING LOAD 
	Hash128(x, Subfield(ys, ',')+1), 	Continent
INLINE [Continent	x	ys
EU	34	-5
EU	35	-5
EU	37	-11,-12,-7,-8
EU	38	-11,-12,-6,-7,-8
EU	39	-10,-11,-7,-8,-9
EU	40	-10,-9
EU	41	-10,-5,-6,-7,-8,-9
EU	42	-1,-10,-11,-12,-4,-5,-6,-7,-8,-9
EU	43	-1,-10,-11,-4,-5,-6,-8,-9
EU	44	-1,-10,-11,-12,-3,-4,-5,-7,-8,-9
EU	45	-1,-10,-11,-3,-4,-5,-6,-7,-8,-9
EU	46	-3,-4,-5,-6,-7,-8,-9
EU	47	-3,-4,-5,-6,-7,-8,-9
EU	48	-4,-5,-6,-7,-8,-9
EU	49	-10,-4,-5,-6,-7,-8,-9
EU	50	-10,-4,-5,-6,-7,-8,-9
EU	51	-4,-5,-6,-7,-8,-9
EU	52	-3,-4,-5,-6,-7,-8
EU	53	-2,-3,-4,-5,-6,-7
EU	54	-2,-4,-5,-6
SA	20	-21,-22,-23		
SA	21	-19,-20,-21,-22,-23,-24,-25,-34,-35		
SA	22	-19,-20,-21,-22,-23,-24,-25,-26,-30,-31,-32,-33,-34,-35,-36		
SA	23	-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30,-31,-32,-33		
SA	24	-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30,-31,-32		
SA	25	-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30,-31		
SA	26	-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30		
SA	27	-21,-22,-23,-24,-25,-26,-27,-28,-29		
SA	28	-22,-23,-24,-25,-26,-27		
SA	29	-22,-23,-24,-25,-26,-27		
SA	30	-23,-24		
AF	35	-16,-17,-18
AF	36	-15,-16,-17,-18,-19
AF	37	-13,-14,-15,-16,-17,-18,-19,-20
AF	38	-13,-14,-15,-16,-17,-18,-19,-20
AF	39	-13,-14,-15,-16,-17,-18,-19,-20
AF	40	-12,-13,-14,-15,-16,-17,-18,-19,-20
AF	41	-12,-13,-14,-15,-16,-17,-18,-19,-20
AF	42	-13,-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26
AF	43	-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29
AF	44	-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30
AF	45	-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29,-30
AF	46	-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26,-27,-28,-29
AF	47	-14,-15,-16,-17,-18,-19,-20,-21,-22,-23,-24,-25,-26,-27,-28
AF	48	-17,-18,-19,-20,-21,-22,-23,-24,-25,-26
AF	49	-18,-19,-20,-21
AF	50	-18,-19,-20,-26,-27
AF	51	-19,-25,-26
NA	0	-4,-5,-6
NA	1	-3,-4,-5,-6,-7
NA	2	-3,-4,-5,-6
NA	3	-4,-5,-6
NA	4	-4,-5
NA	5	-4,-5,-6
NA	6	-4,-5,-6
NA	7	-4,-5,-6
NA	8	-4,-5,-6,-7
NA	9	-4,-5,-6,-7,-8
NA	10	-10,-11,-12,-3,-4,-5,-6,-7,-8,-9
NA	11	-10,-11,-12,-13,-3,-4,-5,-6,-7,-8,-9
NA	12	-1,-10,-11,-12,-13,-14,-2,-3,-4,-5,-6,-7,-8,-9
NA	13	-1,-10,-11,-12,-13,-14,-15,-2,-3,-4,-5,-6,-7,-8,-9
NA	14	-1,-10,-11,-12,-13,-14,-15,-16,-2,-3,-4,-5,-6,-7,-8,-9
NA	15	-1,-10,-11,-12,-13,-14,-15,-16,-17,-2,-3,-4,-5,-6,-7,-8,-9
NA	16	-10,-11,-12,-13,-14,-15,-16,-17,-2,-3,-4,-5,-6,-7,-8,-9
NA	17	-1,-10,-11,-12,-13,-14,-17,-2,-3,-4,-5,-7,-8,-9
NA	18	-1,-10,-11,-12,-13,-14,-16,-17,-18,-2,-3,-4,-5,-7,-8,-9,0
NA	19	-1,-10,-11,-12,-13,-14,-18,-19,-4,-8,-9,0
NA	20	-1,-10,-11,-12,-13,-14,-15,-16,-19,-2,-3,-8,-9,0
NA	21	-1,-10,-11,-12,-16,-2,-3,-5,-6,-7,-8,-9,0
NA	22	-10,-11,-17,-2,-3,-4,-5,-6,-7,-8,-9,0
NA	23	-1,-10,-17,-4,-5,-6,-7,-8,-9
NA	24	-1,-10,-4,-5,-7,-8,-9,0
NA	25	-1,-7,-8,0
NA	26	-1,-2,-8,-9,0
NA	27	-1,-2,-3,-4,-5,0
NA	28	-1,-2,-3,-4,-5,-6,0
NA	29	-1,-2,-3,-4,-5,-6,0
NA	30	-1,-2,-3,-4,0
NA	31	-1,-2,-3,-4,0
NA	32	-1,-2,-3,0
NA	33	-1,-2,-3,0
NA	34	-1,-2,0
NA	35	0
AU	67	-27,-28,-29,-30
AU	68	-27,-28,-29,-30
AU	69	-26,-27,-28,-29,-30
AU	70	-25,-26,-27,-28,-29
AU	71	-25,-26,-27,-28,-29
AU	72	-26,-27,-28,-29,-30
AU	73	-22,-23,-25,-26,-27,-28,-29,-30,-31
AU	74	-23,-24,-26,-27,-28,-29,-30,-31,-32
AU	75	-27,-28,-29,-30,-31
AU	76	-24,-28,-29
AU	78	-26
AU	79	-27
AU	80	-32,-33
AU	81	-30,-31,-32
AU	82	-31
] (delimiter is '\t');

LET vWest = -163;
LET vEast = 179;
LET vNorth = 79;
LET vSouth = -56;
LET vX.Min = 0;
LET vX.Max = Null();
LET vY.Min = -NoOfRows('TextMap') + 1;
LET vY.Max = 0;

FOR v = 1 TO NoOfRows('TextMap')
	LET vRow = Peek('@1', v-1, 'TextMap');
    LET vX.Max = RangeMax(vX.Max, Len(vRow)-1);
    DottedMap:
    LOAD
		RowNo() AS dotId,
        -$(v) + 1 AS y, 
        RecNo()-1 AS x,
        ApplyMap('ContinentForPoint', Hash128(RecNo()-1, -$(v) + 1), 'AS') AS Continent
    AUTOGENERATE(Len(vRow))
    WHERE 
    	Mid('$(vRow)', RecNo(), 1) <> ' ';
NEXT v

DROP TABLE TextMap;

// interpolate x and y into longitude/latitude
LEFT JOIN (DottedMap)
LOAD 
	dotId,
	x * ($(vEast) - $(vWest)) / ($(vX.Max) - $(vX.Min)) + $(vWest) AS long,
    y * ($(vNorth) - $(vSouth)) / ($(vY.Max) - $(vY.Min)) + $(vNorth) AS lat
RESIDENT DottedMap;    

FOR EACH v IN 'vWest','vEast','vNorth','vSouth','vX.Min','vX.Max','vY.Min','vY.Max','vRow'
	LET $(v) = Null(); // delete temp variable
NEXT v;

